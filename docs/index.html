<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Just Do It | Minimalist Todo</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=Lato:wght@400;700&family=Merriweather:wght@900&family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Base & Theming --- */
        /* CSS Change: Theming system updated */
        :root {
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
            --anim-duration: 350ms;
            
            /* Default Font Theme */
            --font-body: 'Courier Prime', monospace;
            --font-ui: 'Lato', sans-serif;
            --font-heading: 'Lato', sans-serif;
        }

        /* Default Dark Theme */
        body, body.theme-dark {
            --bg-color: #1a1a1a;
            --surface-color: #2c2c2c;
            --element-bg: #3a3a3a;
            --text-color: #e0e0e0;
            --text-muted: #888888;
            --accent-color: #00bfa5;
            --accent-text: #1a1a1a;
            --border-color: #444444;
            --priority-high: #ff5252;
            --priority-medium: #ffab40;
            --priority-low: #448aff;
        }

        body.theme-light {
            --bg-color: #f4f4f9;
            --surface-color: #ffffff;
            --element-bg: #fdfdfd;
            --text-color: #222222;
            --text-muted: #666666;
            --accent-color: #2962ff;
            --accent-text: #ffffff;
            --border-color: #e0e0e0;
        }
        
        body.theme-ocean {
            --bg-color: #0f1c2e;
            --surface-color: #1a2b42;
            --element-bg: #223a59;
            --text-color: #d0e1ff;
            --text-muted: #7a8eb3;
            --accent-color: #00bfa5;
            --accent-text: #0f1c2e;
            --border-color: #2a4a75;
        }
        
        body.theme-lava {
            --bg-color: #2a363b;
            --surface-color: #3e4d52;
            --element-bg: #4a5c62;
            --text-color: #eaf2e3;
            --text-muted: #a3b1ad;
            --accent-color: #e84a5f;
            --accent-text: #f0f0f0;
            --border-color: #5d7178;
        }
        
        /* Font Themes */
        body.font-sans {
            --font-body: 'Inter', sans-serif;
            --font-ui: 'Inter', sans-serif;
            --font-heading: 'Inter', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            padding-top: 5vh;
            font-size: 16px;
            transition: background-color 0.3s, color 0.3s;
        }

        /* --- Main Container --- */
        .container {
            width: 100%;
            max-width: 600px;
            padding: 30px;
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s, border-color 0.3s;
            position: relative; /* For settings button positioning */
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            transition: border-color 0.3s;
        }

        header h1 {
            font-family: var(--font-heading);
            font-weight: 900;
            font-size: 2.5rem;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        header h1::before {
            content: '✓';
            color: var(--accent-color);
        }

        #quote {
            font-family: var(--font-ui);
            font-size: 0.9rem;
            color: var(--text-muted);
            font-style: italic;
            min-height: 1.2em;
            animation: fadeIn 1s ease-out;
            transition: opacity 0.3s, height 0.3s, margin 0.3s;
        }
        
        #quote.hidden {
            opacity: 0;
            height: 0;
            margin: 0;
            min-height: 0;
        }

        /* --- Form Elements --- */
        #task-form {
            display: flex;
            gap: 10px;
            margin-bottom: 25px;
        }

        #task-input, #priority-select, #sort-select {
            border: 1px solid var(--border-color);
            background-color: var(--element-bg);
            color: var(--text-color);
            border-radius: 5px;
            transition: border-color 0.3s, background-color 0.3s;
        }
        #task-input { flex-grow: 1; padding: 12px 15px; font-family: var(--font-body); font-size: 1rem; }
        #priority-select { padding: 12px 10px; font-family: var(--font-ui); font-size: 0.9rem; }
        #task-input::placeholder { color: var(--text-muted); }
        #task-input:focus, #priority-select:focus, #sort-select:focus { outline: none; border-color: var(--accent-color); }
        
        #add-task-btn {
            background-color: var(--accent-color);
            color: var(--accent-text);
            border: none; padding: 12px 20px; border-radius: 5px; cursor: pointer;
            font-family: var(--font-ui); font-weight: 700; font-size: 1rem;
            transition: background-color 0.3s;
        }
        #add-task-btn:hover { background-color: color-mix(in srgb, var(--accent-color) 90%, black); }

        /* --- Task List --- */
        #todo-list { list-style: none; max-height: 40vh; overflow-y: auto; padding-right: 10px; position: relative; min-height: 75px; }
        #todo-list::-webkit-scrollbar { width: 8px; }
        #todo-list::-webkit-scrollbar-track { background: var(--surface-color); }
        #todo-list::-webkit-scrollbar-thumb { background: var(--element-bg); border-radius: 4px; }
        #todo-list::-webkit-scrollbar-thumb:hover { background: var(--border-color); }

        .todo-item {
            display: flex; align-items: center; padding: 15px; background-color: var(--element-bg);
            border-radius: 5px; margin-bottom: 10px; border-left: 5px solid; transform: scale(1);
            overflow: hidden; max-height: 100px;
            transition: opacity calc(var(--anim-duration) / 2) ease, transform calc(var(--anim-duration) / 2) ease,
                        max-height var(--anim-duration) ease, padding var(--anim-duration) ease,
                        margin var(--anim-duration) ease, background-color 0.3s;
        }
        
        .todo-item.task-entering { animation: slideInFade var(--anim-duration) ease-out forwards; }
        .todo-item.task-collapsing { opacity: 0; max-height: 0; padding-top: 0; padding-bottom: 0; margin-bottom: 0; transform: scale(0.98); border-width: 0; }
        .todo-item.priority-high { border-color: var(--priority-high); }
        .todo-item.priority-medium { border-color: var(--priority-medium); }
        .todo-item.priority-low { border-color: var(--priority-low); }
        .todo-item.completed { opacity: 0.5; }
        .todo-item.completed .task-text { text-decoration: line-through; color: var(--text-muted); }
        .todo-item input[type="checkbox"] { -webkit-appearance: none; appearance: none; background-color: var(--surface-color); margin-right: 15px; font: inherit; color: var(--text-color); width: 1.15em; height: 1.15em; border: 1px solid var(--border-color); border-radius: 3px; transform: translateY(-0.075em); display: grid; place-content: center; cursor: pointer; }
        .todo-item input[type="checkbox"]::before { content: ""; width: 0.65em; height: 0.65em; transform: scale(0); transition: 120ms transform ease-in-out; box-shadow: inset 1em 1em var(--accent-color); transform-origin: bottom left; clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 62%); }
        .todo-item input[type="checkbox"]:checked::before { transform: scale(1); }
        .todo-item .task-text { flex-grow: 1; }
        .delete-btn { background: none; border: none; color: var(--text-muted); font-size: 1.2rem; cursor: pointer; transition: color 0.3s, transform 0.2s ease; padding: 0 5px; }
        .delete-btn:hover { color: var(--priority-high); transform: scale(1.2); }

        /* --- Controls Area --- */
        .controls { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; gap: 20px; margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-color); transition: border-color 0.3s;}
        .controls-left { display: flex; flex-wrap: wrap; align-items: center; gap: 15px; }
        .filters button { background: none; border: 1px solid var(--border-color); color: var(--text-muted); padding: 8px 15px; border-radius: 5px; cursor: pointer; font-family: var(--font-ui); font-size: 0.9rem; margin-right: 5px; transition: all 0.3s; }
        .filters button:hover { color: var(--text-color); border-color: var(--text-color); }
        .filters button.active { background-color: var(--accent-color); border-color: var(--accent-color); color: var(--accent-text); font-weight: 700; }
        .sorting { display: flex; align-items: center; gap: 8px; }
        .sorting label { font-family: var(--font-ui); font-size: 0.9rem; color: var(--text-muted); }
        #sort-select { padding: 7px; font-family: var(--font-ui); font-size: 0.9rem; }
        #clear-completed-btn { background: none; border: none; color: var(--text-muted); cursor: pointer; font-family: var(--font-ui); transition: color 0.3s; }
        #clear-completed-btn:hover { color: var(--priority-high); text-decoration: underline; }

        /* --- CSS Change: Settings Panel Styles --- */
        #settings-btn {
            position: absolute; top: 15px; right: 15px; background: none; border: none;
            color: var(--text-muted); font-size: 1.5rem; cursor: pointer;
            transition: color 0.3s, transform 0.3s; padding: 5px; line-height: 1;
        }
        #settings-btn:hover { color: var(--text-color); transform: rotate(45deg); }

        .settings-panel {
            position: fixed; top: 0; right: -320px; /* Start off-screen */
            width: 300px; height: 100%; background-color: var(--surface-color);
            z-index: 1000; box-shadow: -10px 0 30px rgba(0,0,0,0.3);
            padding: 20px; overflow-y: auto;
            transition: right 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .settings-panel.open { right: 0; }
        .settings-panel h2 { font-family: var(--font-heading); margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
        .settings-panel .close-btn { position: absolute; top: 15px; right: 20px; font-size: 2rem; background: none; border: none; color: var(--text-muted); cursor: pointer; transition: color 0.3s; }
        .settings-panel .close-btn:hover { color: var(--text-color); }
        .setting-group { margin-bottom: 25px; }
        .setting-group h3 { font-family: var(--font-ui); font-size: 1rem; color: var(--text-muted); margin-bottom: 12px; }
        
        .theme-options, .font-options { display: grid; gap: 10px; }
        .theme-options { grid-template-columns: repeat(2, 1fr); }
        .theme-options button, .font-options button { width: 100%; padding: 10px; background-color: var(--element-bg); border: 2px solid var(--border-color); border-radius: 5px; cursor: pointer; transition: all 0.2s; font-family: var(--font-ui); color: var(--text-color); }
        .theme-options button:hover, .font-options button:hover { border-color: var(--accent-color); }
        .theme-options button.active, .font-options button.active { border-color: var(--accent-color); background-color: color-mix(in srgb, var(--accent-color) 20%, var(--element-bg)); }
        
        .toggle-group { display: flex; justify-content: space-between; align-items: center; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--element-bg); transition: .4s; border-radius: 28px; }
        .slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: var(--text-muted); transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(22px); background-color: white; }
        
        .data-options button { width: 100%; padding: 10px; border-radius: 5px; margin-bottom: 10px; font-family: var(--font-ui); cursor: pointer; background-color: var(--element-bg); border: 1px solid var(--border-color); color: var(--text-color); transition: all 0.2s; }
        .data-options button:hover { border-color: var(--text-color); }
        .danger-zone { border: 1px solid var(--priority-high); border-radius: 5px; padding: 15px; }
        .danger-zone h3 { color: var(--priority-high); }
        .danger-zone button { width: 100%; background-color: var(--priority-high); color: white; }

        /* --- Keyframes --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInFade { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
    </style>
</head>
<body>

    <main class="container">
        <button id="settings-btn" title="Settings">⚙️</button>

        <header>
            <h1>Just Do It</h1>
            <p id="quote"></p>
        </header>

        <form id="task-form">
            <input type="text" id="task-input" placeholder="Add a new task..." autocomplete="off">
            <select id="priority-select">
                <option value="low">Low</option>
                <option value="medium" selected>Medium</option>
                <option value="high">High</option>
            </select>
            <button type="submit" id="add-task-btn">Add</button>
        </form>

        <ul id="todo-list"></ul>

        <div class="controls">
            <div class="controls-left">
                <div class="filters">
                    <button class="active" data-filter="all">All</button>
                    <button data-filter="active">Active</button>
                    <button data-filter="completed">Completed</button>
                </div>
                <div class="sorting">
                    <label for="sort-select">Sort:</label>
                    <select id="sort-select">
                        <option value="date-desc">Newest</option>
                        <option value="date-asc">Oldest</option>
                        <option value="priority-desc">Priority ↓</option>
                        <option value="priority-asc">Priority ↑</option>
                        <option value="alpha-asc">A-Z</option>
                        <option value="alpha-desc">Z-A</option>
                    </select>
                </div>
            </div>
            <button id="clear-completed-btn">Clear Completed</button>
        </div>
    </main>
    
    <div id="settings-panel" class="settings-panel">
        <button class="close-btn" title="Close settings">&times;</button>
        <h2>Settings</h2>

        <div class="setting-group">
            <h3>Theme</h3>
            <div class="theme-options">
                <button data-theme="dark" class="active">Dark</button>
                <button data-theme="light">Light</button>
                <button data-theme="ocean">Ocean</button>
                <button data-theme="lava">Lava</button>
            </div>
        </div>
        
        <div class="setting-group">
            <h3>Font</h3>
            <div class="font-options">
                 <button data-font="default" class="active">UI & Mono</button>
                 <button data-font="sans">Sans Serif</button>
            </div>
        </div>

        <div class="setting-group">
             <div class="toggle-group">
                <h3>Show Quote</h3>
                <label class="toggle-switch">
                    <input type="checkbox" id="quote-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-group">
            <h3>Data</h3>
            <div class="data-options">
                 <button id="export-btn">Export Tasks</button>
                 <button id="import-btn">Import Tasks</button>
                 <input type="file" id="import-file-input" accept=".json" style="display: none;">
            </div>
        </div>
        
        <div class="setting-group danger-zone">
            <h3>Danger Zone</h3>
            <button id="clear-all-btn">Clear All Tasks</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Main App Selectors
            const taskForm = document.getElementById('task-form');
            const taskInput = document.getElementById('task-input');
            const prioritySelect = document.getElementById('priority-select');
            const todoList = document.getElementById('todo-list');
            const filterBtns = document.querySelectorAll('.filters button');
            const clearCompletedBtn = document.getElementById('clear-completed-btn');
            const sortSelect = document.getElementById('sort-select');
            const quoteElement = document.getElementById('quote');
            
            // --- JS Change: Settings Panel Selectors ---
            const settingsBtn = document.getElementById('settings-btn');
            const settingsPanel = document.getElementById('settings-panel');
            const closeSettingsBtn = settingsPanel.querySelector('.close-btn');
            const themeOptions = document.querySelectorAll('.theme-options button');
            const fontOptions = document.querySelectorAll('.font-options button');
            const quoteToggle = document.getElementById('quote-toggle');
            const exportBtn = document.getElementById('export-btn');
            const importBtn = document.getElementById('import-btn');
            const importFileInput = document.getElementById('import-file-input');
            const clearAllBtn = document.getElementById('clear-all-btn');

            const cloneWarsQuotes = ["Great leaders inspire greatness in others.", "Belief is not a matter of choice, but of conviction.", "Easy is the path to wisdom for those not blinded by themselves.", "A plan is only as good as those who see it through.", "The best confidence builder is experience.", "Trust in your friends, and they’ll have reason to trust in you.", "Choose what is right, not what is easy.", "The most dangerous beast is the beast within.", "Who you are tomorrow begins with what you do today.", "To seek something is to believe in its possibility.", "For everything you gain, you lose something else.", "It is a rough road that leads to the heights of greatness."];

            let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
            // --- JS Change: Settings object with defaults ---
            let settings = JSON.parse(localStorage.getItem('settings')) || {
                theme: 'dark',
                font: 'default',
                quoteVisible: true
            };

            let currentFilter = 'all';
            let currentSort = 'date-desc';

            const saveTasks = () => localStorage.setItem('tasks', JSON.stringify(tasks));
            const saveSettings = () => localStorage.setItem('settings', JSON.stringify(settings));

            // --- JS Change: Function to apply settings from the settings object ---
            const applySettings = () => {
                // Apply theme
                document.body.className = ''; // Clear existing classes
                document.body.classList.add(`theme-${settings.theme}`);
                document.body.classList.add(`font-${settings.font}`);

                // Apply quote visibility
                quoteElement.classList.toggle('hidden', !settings.quoteVisible);
                
                // Update UI controls in settings panel
                themeOptions.forEach(btn => btn.classList.toggle('active', btn.dataset.theme === settings.theme));
                fontOptions.forEach(btn => btn.classList.toggle('active', btn.dataset.font === settings.font));
                quoteToggle.checked = settings.quoteVisible;
            };
            
            const getVisibleTasks = () => tasks.filter(task => { if (currentFilter === 'active') return !task.completed; if (currentFilter === 'completed') return task.completed; return true; });

            const renderTasks = (newlyAddedId = null) => {
                const visibleTasks = getVisibleTasks();
                const scrollPosition = todoList.scrollTop;
                todoList.innerHTML = '';
                const priorityValues = { high: 3, medium: 2, low: 1 };
                let sortedTasks = [...visibleTasks];
                switch (currentSort) {
                    case 'date-asc': sortedTasks.sort((a, b) => a.id - b.id); break;
                    case 'priority-desc': sortedTasks.sort((a, b) => priorityValues[b.priority] - priorityValues[a.priority] || b.id - a.id); break;
                    case 'priority-asc': sortedTasks.sort((a, b) => priorityValues[a.priority] - priorityValues[b.priority] || b.id - a.id); break;
                    case 'alpha-asc': sortedTasks.sort((a, b) => a.text.localeCompare(b.text)); break;
                    case 'alpha-desc': sortedTasks.sort((a, b) => b.text.localeCompare(a.text)); break;
                    case 'date-desc': default: sortedTasks.sort((a, b) => b.id - a.id); break;
                }

                if (sortedTasks.length === 0) {
                    const emptyMessage = document.createElement('li');
                    emptyMessage.className = 'todo-item'; emptyMessage.style.borderColor = 'var(--border-color)'; emptyMessage.style.color = 'var(--text-muted)'; emptyMessage.style.justifyContent = 'center'; emptyMessage.textContent = 'No tasks here. Add one above!';
                    todoList.appendChild(emptyMessage);
                    return;
                }
                
                sortedTasks.forEach(task => {
                    const li = document.createElement('li');
                    li.className = `todo-item priority-${task.priority}`;
                    if (task.completed) li.classList.add('completed');
                    li.dataset.id = task.id;
                    if (task.id === newlyAddedId) li.classList.add('task-entering');
                    const checkbox = document.createElement('input'); checkbox.type = 'checkbox'; checkbox.checked = task.completed;
                    const taskTextSpan = document.createElement('span'); taskTextSpan.className = 'task-text'; taskTextSpan.textContent = task.text;
                    const deleteBtn = document.createElement('button'); deleteBtn.className = 'delete-btn'; deleteBtn.textContent = '×';
                    li.append(checkbox, taskTextSpan, deleteBtn);
                    todoList.appendChild(li);
                });
                todoList.scrollTop = scrollPosition;
            };

            const addTask = (e) => {
                e.preventDefault();
                const taskText = taskInput.value.trim();
                if (taskText === '') return;
                const newTask = { id: Date.now(), text: taskText, priority: prioritySelect.value, completed: false };
                tasks.push(newTask);
                saveTasks();
                renderTasks(newTask.id);
                taskInput.value = '';
                taskInput.focus();
            };
            
            const handleListClick = (e) => {
                const parentLi = e.target.closest('.todo-item');
                if (!parentLi || !parentLi.dataset.id) return;
                const taskId = Number(parentLi.dataset.id);

                if (e.target.matches('input[type="checkbox"]')) {
                    const task = tasks.find(t => t.id === taskId);
                    if (task) {
                        task.completed = !task.completed;
                        saveTasks();
                        parentLi.classList.toggle('completed');
                        if (currentFilter !== 'all') {
                            parentLi.classList.add('task-collapsing');
                            parentLi.addEventListener('transitionend', (event) => {
                                if (event.propertyName === 'max-height') renderTasks();
                            }, { once: true });
                        }
                    }
                }

                if (e.target.matches('.delete-btn')) {
                    parentLi.classList.add('task-collapsing');
                    parentLi.addEventListener('transitionend', (event) => {
                        if (event.propertyName === 'max-height') {
                            tasks = tasks.filter(t => t.id !== taskId);
                            saveTasks();
                            parentLi.remove();
                            if (getVisibleTasks().length === 0) renderTasks();
                        }
                    }, { once: true });
                }
            };
            
            const handleFilterClick = (e) => { filterBtns.forEach(btn => btn.classList.remove('active')); e.target.classList.add('active'); currentFilter = e.target.dataset.filter; renderTasks(); };
            const handleSortChange = (e) => { currentSort = e.target.value; renderTasks(); };

            const clearCompleted = () => {
                const completedItems = todoList.querySelectorAll('.todo-item.completed');
                if (completedItems.length === 0) return;
                const transitions = Array.from(completedItems).map(item => new Promise(resolve => {
                    item.classList.add('task-collapsing');
                    item.addEventListener('transitionend', (event) => { if (event.propertyName === 'max-height') resolve(); }, { once: true });
                }));
                Promise.all(transitions).then(() => { tasks = tasks.filter(task => !task.completed); saveTasks(); renderTasks(); });
            };

            const displayRandomQuote = () => { const randomIndex = Math.floor(Math.random() * cloneWarsQuotes.length); quoteElement.textContent = `"${cloneWarsQuotes[randomIndex]}"`; };

            // --- JS Change: Settings Panel Logic ---
            settingsBtn.addEventListener('click', () => settingsPanel.classList.add('open'));
            closeSettingsBtn.addEventListener('click', () => settingsPanel.classList.remove('open'));
            
            themeOptions.forEach(button => button.addEventListener('click', () => { settings.theme = button.dataset.theme; saveSettings(); applySettings(); }));
            fontOptions.forEach(button => button.addEventListener('click', () => { settings.font = button.dataset.font; saveSettings(); applySettings(); }));
            quoteToggle.addEventListener('change', () => { settings.quoteVisible = quoteToggle.checked; saveSettings(); applySettings(); });

            exportBtn.addEventListener('click', () => {
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tasks, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", "tasks.json");
                document.body.appendChild(downloadAnchorNode);
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
            });

            importBtn.addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    if (confirm("This will overwrite all current tasks. Are you sure?")) {
                        try {
                            const importedTasks = JSON.parse(event.target.result);
                            tasks = importedTasks;
                            saveTasks();
                            renderTasks();
                        } catch (error) {
                            alert("Error: Invalid file format.");
                        }
                    }
                };
                reader.readAsText(file);
                importFileInput.value = ''; // Reset input
            });

            clearAllBtn.addEventListener('click', () => {
                if (confirm("Are you sure you want to delete ALL tasks? This cannot be undone.")) {
                    tasks = [];
                    saveTasks();
                    renderTasks();
                }
            });

            // --- App Initialization ---
            taskForm.addEventListener('submit', addTask);
            todoList.addEventListener('click', handleListClick);
            filterBtns.forEach(btn => btn.addEventListener('click', handleFilterClick));
            clearCompletedBtn.addEventListener('click', clearCompleted);
            sortSelect.addEventListener('change', handleSortChange);
            
            displayRandomQuote();
            applySettings(); // Apply saved settings on load
            renderTasks(); // Render tasks
        });
    </script>
</body>
</html>
